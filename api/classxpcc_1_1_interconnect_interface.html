<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>XPCC: xpcc::InterconnectInterface Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">XPCC
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classxpcc_1_1_interconnect_interface.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">xpcc::InterconnectInterface Class Reference<div class="ingroups"><a class="el" href="group__connectivity.html">Connectivity</a></div></div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="xpcc::InterconnectInterface" -->
<p>Type safe interface for the interconnect link.  
 <a href="classxpcc_1_1_interconnect_interface.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="interconnect__interface_8hpp_source.html">xpcc/driver/connectivity/interconnect/interconnect_interface.hpp</a>&gt;</code></p>

<p><a href="classxpcc_1_1_interconnect_interface-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxpcc_1_1_interconnect_interface_1_1_buffer.html">Buffer</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abff5018fec07d8ee6ea295dd35195589"></a><!-- doxytag: member="xpcc::InterconnectInterface::initialize" ref="abff5018fec07d8ee6ea295dd35195589" args="()" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>initialize</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a34d17e3c5ffc2a63e350fd802ba3700c"></a><!-- doxytag: member="xpcc::InterconnectInterface::makeTransaction" ref="a34d17e3c5ffc2a63e350fd802ba3700c" args="()" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>makeTransaction</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const R *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxpcc_1_1_interconnect_interface.html#ab87aa64b142ba6951a522eac45c49095">getReceiveBuffer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Access the receive buffer.  <a href="#ab87aa64b142ba6951a522eac45c49095"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9f0606bbfbc84a2b2eb7572bd6760161"></a><!-- doxytag: member="xpcc::InterconnectInterface::releaseReceiveBuffer" ref="a9f0606bbfbc84a2b2eb7572bd6760161" args="()" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>releaseReceiveBuffer</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const T *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxpcc_1_1_interconnect_interface.html#ab6cd68ae93f9cc812959c5934c7ee0fb">readTransmitBuffer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Access the transmit buffer without changing it.  <a href="#ab6cd68ae93f9cc812959c5934c7ee0fb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static T *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxpcc_1_1_interconnect_interface.html#af7b94b18660fccd4e20534f03677dede">getTransmitBuffer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Access the transmit buffer.  <a href="#af7b94b18660fccd4e20534f03677dede"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a53e643c14870653cc86e816a4595ffc0"></a><!-- doxytag: member="xpcc::InterconnectInterface::releaseTransmitBuffer" ref="a53e643c14870653cc86e816a4595ffc0" args="()" -->
static void&#160;</td><td class="memItemRight" valign="bottom"><b>releaseTransmitBuffer</b> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>The connected of the Transmit and Receive structs (T &amp; R) are updated should be updated periodically. Simple sensor data can therefore directly stored within the structs.</p>
<p>More care needs to be taken when it comes to commands. The simplest and most reliable way is to transmit command with two counters. One controlled by the first node and one controlled by the second node.</p>
<p>When a command should be executed the counter is incremented by one. Parameters may also be stored in the transmit struct. The other node keeps a copy of the counter value and compares it to the received counter on every update. When the counter changes, it extecutes the corresponding command und stores the new counter value. This way it is made sure that the command is executed only once. To signal that the command is finished the counter in the other direction is used. The node sets the value of that counter to value of the counter received by the other node.</p>
<p>The transmitting node must now only check if the received counter equals the transmitted counter to know when the command was successfully executed.</p>
<h2>Example</h2>
<p>Definition of the two counters and the paramter field: </p>
<div class="fragment"><pre class="fragment">
<span class="keyword">struct </span>MasterToSlave
{
    uint8_t commandCounter;
    Parameter commandParameter;
};

<span class="keyword">struct </span>SlaveToMaster
{
    uint8_t commandResponse;
};
</pre></div><p>Master: </p>
<div class="fragment"><pre class="fragment">
InterconnectInterface&lt;MasterToSlave, SlaveToMaster&gt; interface;

<span class="keywordtype">void</span>
executeCommand(<span class="keyword">const</span> Parameter&amp; parameter)
{
    MasterToSlave *transmit = interface.getTransmitBuffer();
    
    transmit-&gt;commandCounter++;
    transmit-&gt;commandParameter = parameter;
    
    interface.releaseTransmitBuffer();
}

<span class="keywordtype">bool</span>
isFinished()
{
    <span class="keyword">const</span> MasterToSlave *transmit = interface.readTransmitBuffer();
    <span class="keyword">const</span> SlaveToMaster *receive = interface.getReceiveBuffer();
    
    <span class="keywordtype">bool</span> isFinished =
            (transmit-&gt;commandCounter == receive-&gt;commandResponse);
    
    interface.releaseReceiveBuffer();
    <span class="keywordflow">return</span> isFinished;
}
</pre></div><p>Slave: </p>
<div class="fragment"><pre class="fragment">
InterconnectInterface&lt;SlaveToMaster, MasterToSlave&gt; interface;

uint8_t commandCounter;

<span class="keywordtype">void</span>
processReceivedData()
{
    <span class="keyword">const</span> MasterToSlave *receive = interface.getReceiveBuffer();
    
    <span class="keywordflow">if</span> (receive-&gt;commandCounter != commandCounter)
    {
        commandCounter = receive-&gt;commandCounter;
        
        <span class="comment">// execute the command</span>
        doSomething(receive-&gt;commandParameter);
    }
    interface.releaseReceiveBuffer();
}

<span class="keywordtype">void</span>
DataExchange::prepareDataForTransmission()
{
    SlaveToMaster *transmit = interface.getTransmitBuffer();
    
    <span class="keywordflow">if</span> (isSomethingFinished()) {
        transmit-&gt;commandResponse = commandCounter;
    }
    interface.releaseTransmitBuffer();
}
</pre></div><h2>FAQ:</h2>
<p>You get an error message during linking saying something like: </p>
<div class="fragment"><pre class="fragment"> undefined reference to `xpcc::InterconnectLink::sizeReceiveBuffer<span class="stringliteral">&#39;</span>
<span class="stringliteral"> undefined reference to `xpcc::InterconnectLink::sizeTransmitBuffer&#39;</span>
 ...
</pre></div><p>Check that all necessary defines are set in the project file. This may either be CPU_BOARD2_MASTER/CPU_BOARD2_SLAVE when compiling for the CPU Board2 or the following:</p>
<ul>
<li>INTERCONNECT_USART_PORT</li>
<li>INTERCONNECT_USART_ID</li>
<li>INTERCONNECT_PIN_OUTPUT</li>
<li>INTERCONNECT_PIN_INPUT</li>
</ul>
<p>INTERCONNECT_USART_PORT and INTERCONNECT_USART_ID specifiy the used USART interface, INTERCONNECT_PIN_OUTPUT and INTERCONNECT_PIN_INPUT are two status pins which need to be connected crossover to the other microcontroller.</p>
<p>Example for the ATxmega128a1 (from the <code>project.cfg</code> file): </p>
<div class="fragment"><pre class="fragment"> [defines]
 INTERCONNECT_USART_PORT = C
 INTERCONNECT_USART_ID   = 0
 INTERCONNECT_PIN_OUTPUT = C,0
 INTERCONNECT_PIN_INPUT  = C,1
</pre></div><dl><dt><b>Template Parameters:</b></dt><dd>
  <table class="">
    <tr><td class="paramname">T</td><td>Transmit Type </td></tr>
    <tr><td class="paramname">R</td><td>Receive Type</td></tr>
  </table>
  </dd>
</dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Georgi </dd></dl>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab87aa64b142ba6951a522eac45c49095"></a><!-- doxytag: member="xpcc::InterconnectInterface::getReceiveBuffer" ref="ab87aa64b142ba6951a522eac45c49095" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const R* xpcc::InterconnectInterface::getReceiveBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="warning"><dt><b>Warning:</b></dt><dd>You have to call releaseReceiveBuffer() afterwards to enable reception again. Otherwise the reception will be blocked!</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Pointer to the buffer </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>releaseReceiveBuffer() </dd></dl>

</div>
</div>
<a class="anchor" id="ab6cd68ae93f9cc812959c5934c7ee0fb"></a><!-- doxytag: member="xpcc::InterconnectInterface::readTransmitBuffer" ref="ab6cd68ae93f9cc812959c5934c7ee0fb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const T* xpcc::InterconnectInterface::readTransmitBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>No need to call releaseTransmitBuffer(), but it won't damage anything if you do. </p>

</div>
</div>
<a class="anchor" id="af7b94b18660fccd4e20534f03677dede"></a><!-- doxytag: member="xpcc::InterconnectInterface::getTransmitBuffer" ref="af7b94b18660fccd4e20534f03677dede" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static T* xpcc::InterconnectInterface::getTransmitBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="warning"><dt><b>Warning:</b></dt><dd>You have to call releaseTransmitBuffer() afterwards to enable transmission again. Otherwise the transmission will be blocked!</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Pointer to the buffer </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>releaseTransmitBuffer() </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="interconnect__interface_8hpp_source.html">interconnect_interface.hpp</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>xpcc</b>      </li>
      <li class="navelem"><a class="el" href="classxpcc_1_1_interconnect_interface.html">InterconnectInterface</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer" />
<address class="footer"><small>Generated on Mon Mar 5 2012 19:28:09 for XPCC by&nbsp;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen" border="0" /></a> 1.7.5</small></address>

<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://sourceforge.net/apps/piwik/xpcc/" : "http://sourceforge.net/apps/piwik/xpcc/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
try {
	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
	piwikTracker.trackPageView();
	piwikTracker.enableLinkTracking();
} catch( err ) {}
</script>
<noscript>
<p><img src="http://sourceforge.net/apps/piwik/xpcc/piwik.php?idsite=1" style="border:0" alt=""/></p>
</noscript>
<!-- End Piwik Tag -->

</body>
</html>
